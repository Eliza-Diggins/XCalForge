
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Library Generation User Guide &#8212; XCalForge  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reference/library/overview';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="XCalForge Example Gallery" href="../../auto_examples/index.html" />
    <link rel="prev" title="XCalForge | System Overview" href="../overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">XCalForge  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    XCalForge | Reference Manual
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../auto_examples/index.html">
    XCalForge Example Gallery
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    XCalForge | Reference Manual
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../auto_examples/index.html">
    XCalForge Example Gallery
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">XCalForge | System Overview</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Library Generation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Library Generation User Guide</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">XCalForge | Reference Manual</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Library Generation User Guide</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="library-generation-user-guide">
<span id="library-gen-user"></span><h1>Library Generation User Guide<a class="headerlink" href="#library-generation-user-guide" title="Link to this heading">#</a></h1>
<p>This guide explains how to build, run,
and manage synthetic calibration modification
libraries using the <cite>xrmodifier</cite> framework.</p>
<p>For theoretical background on the principles
and motivations of library generation, see <a class="reference internal" href="theory.html#library-gen-theory"><span class="std std-ref">Library Generation</span></a>.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The primary goal of library generation is to produce structured, reproducible datasets that map configuration modifications
to observable temperature recovery performance. These datasets serve as the training foundation for fast, differentiable
emulators used in downstream calibration inference.</p>
<p>The library system supports fully generic modifications to the telescope configuration and hyperparameters, including:</p>
<ul class="simple">
<li><p>Changes to spectral models (e.g., different astrophysical models in XSPEC)</p></li>
<li><p>Perturbations to instrumental response files (e.g., ARFs, RMFs)</p></li>
<li><p>Variations in exposure settings or background modeling</p></li>
<li><p>Arbitrary extensions defined by the user</p></li>
</ul>
<p>The class <code class="xref py py-class docutils literal notranslate"><span class="pre">xforge.library.base.ModificationLibrary</span></code> provides the base interface and tooling
to implement such modification libraries.</p>
</section>
<section id="library-structure">
<h2>Library Structure<a class="headerlink" href="#library-structure" title="Link to this heading">#</a></h2>
<p>A generated library has a well-defined, self-contained directory structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>library_dir/
├── library.h5     # HDF5 data file (parameter grid, results, temperatures)
├── config.yaml    # Persistent configuration file
├── logs/          # Per-rank log files
├── cache/         # Temporary working directory (cleared by default after generation)
├── bin/           # Optional directory for persistent outputs (e.g., modified ARFs)
</pre></div>
</div>
<p>Details:</p>
<ul class="simple">
<li><p><strong>`library.h5`</strong> contains:</p>
<ul>
<li><p><cite>PARAMS</cite> group: Parameter grids for modification hyperparameters.</p></li>
<li><p><cite>LIBRARY</cite> group (after generation): Simulation temperatures and results arrays.</p></li>
</ul>
</li>
<li><p><strong>`config.yaml`</strong> uses <code class="xref py py-class docutils literal notranslate"><span class="pre">utils.ConfigManager</span></code> for structured access and storage of run settings.</p></li>
<li><p><strong>`logs/`</strong> provides separate log files for each MPI rank.</p></li>
<li><p><strong>`cache/`</strong> holds transient data such as synthetic spectra or working files during generation.</p></li>
<li><p><strong>`bin/`</strong> is optional for outputs intended to persist beyond the generation process.</p></li>
</ul>
<p>Re-loading a library from disk is done via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">xforge.library</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianARFLibrary</span>

<span class="n">lib</span> <span class="o">=</span> <span class="n">GaussianARFLibrary</span><span class="p">(</span><span class="s2">&quot;/path/to/library_dir&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The library validates structure and loads its configuration and parameter space automatically.</p>
</section>
<section id="the-simulation-process">
<h2>The Simulation Process<a class="headerlink" href="#the-simulation-process" title="Link to this heading">#</a></h2>
<p>Before diving into user modifications, it is important to understand the simulation and fitting workflow that underpins
the library generation process:</p>
<p><strong>Simulate with Modified Configuration:</strong></p>
<ul class="simple">
<li><p>Synthetic photon spectra are generated using the <em>modified</em> telescope configuration, which reflects the true but unknown
calibration state of the instrument.</p></li>
<li><p>This incorporates distortions or biases introduced by calibration errors (e.g., ARF distortions).</p></li>
<li><p>In practice, this step uses XSPEC’s <code class="docutils literal notranslate"><span class="pre">fakeit</span></code> functionality with modified inputs to produce simulated observational data.</p></li>
</ul>
<p><strong>Fit with Modified Configuration:</strong></p>
<ul class="simple">
<li><p>The same modified configuration can be used to fit the simulated data.</p></li>
<li><p>This serves as a sanity check: fitting with the correct calibration should accurately recover the true physical parameters
(e.g., plasma temperature).</p></li>
<li><p>Some workflows omit this step, focusing only on recovery errors under incorrect calibration assumptions.</p></li>
</ul>
<p><strong>Fit with Unmodified Configuration:</strong></p>
<ul class="simple">
<li><p>The simulated data (generated with the modified, true configuration) is analyzed as if the telescope calibration were correct,
using the <em>unmodified</em> configuration currently in operational use.</p></li>
<li><p>This mimics real-world scenarios where outdated or imperfect calibration files produce incorrect parameter estimates.</p></li>
</ul>
<p><strong>Record Results:</strong></p>
<ul class="simple">
<li><p>The primary quantity stored in the library is the discrepancy between known truth and recovered parameters when using
the unmodified configuration.</p></li>
<li><p>This enables building a mapping from calibration modifications to temperature recovery errors.</p></li>
</ul>
<p><strong>Temperature Sweep</strong></p>
<ul class="simple">
<li><p>The above steps are repeated across a user-defined grid of plasma temperatures.</p></li>
<li><p>This ensures the library captures calibration effects over the full relevant physical parameter space.</p></li>
</ul>
<p>This process is repeated across the entire parameter grid of calibration modifications and temperatures in a distributed,
MPI-parallelized workflow. The result is a dense, HDF5-backed library capturing how calibration errors distort temperature
inference across a wide range of conditions.</p>
<section id="building-simulation-pipelines">
<h3>Building Simulation Pipelines<a class="headerlink" href="#building-simulation-pipelines" title="Link to this heading">#</a></h3>
<p>The abstract class <a class="reference internal" href="../../_as_gen/library.base.ModificationLibrary.html#library.base.ModificationLibrary" title="library.base.ModificationLibrary"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModificationLibrary</span></code></a> defines the general structure and sequence of operations
required for a calibration modification library. To create a custom library, users
subclass <a class="reference internal" href="../../_as_gen/library.base.ModificationLibrary.html#library.base.ModificationLibrary" title="library.base.ModificationLibrary"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModificationLibrary</span></code></a> and implement abstract classes to configure the behavior. There are
3 parts of the simulation which can be configured:</p>
<ol class="arabic">
<li><p><strong>Configuration</strong></p>
<p>The first area for customization is the <strong>configuration</strong>, which defines all parameters
necessary to simulate the telescope response. This includes, but is not limited to:</p>
<ul class="simple">
<li><p>Ancillary Response Files (ARFs)</p></li>
<li><p>Redistribution Matrix Files (RMFs)</p></li>
<li><p>Exposure settings</p></li>
<li><p>Background files</p></li>
<li><p>Instrument-specific corrections</p></li>
</ul>
<p>These configurations control how XSPEC generates synthetic spectra via the <cite>fakeit</cite> interface.
In <cite>xrmodifier</cite>, the user provides both a baseline (trusted) configuration and a modified (perturbed) configuration to test calibration hypotheses.</p>
<p>The two abstract methods responsible for defining configurations are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_unmodified_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_modified_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Both methods must return a dictionary containing the required file paths and settings for XSPEC, typically structured as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="p">{</span>
       <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/rmf.rmf&quot;</span><span class="p">,</span>
       <span class="s2">&quot;arf&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/arf.arf&quot;</span><span class="p">,</span>
       <span class="s2">&quot;exposure&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>  <span class="c1"># Optional, defaults to 50 ks</span>
       <span class="s2">&quot;background&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/bkg.pha&quot;</span><span class="p">,</span>  <span class="c1"># Optional</span>
       <span class="s2">&quot;correction&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/corr.arf&quot;</span><span class="p">,</span>  <span class="c1"># Optional</span>
       <span class="s2">&quot;backExposure&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>  <span class="c1"># Optional</span>
   <span class="p">}</span>

<span class="o">**</span><span class="n">Modified</span> <span class="n">Configuration</span><span class="o">**</span>

<span class="o">-</span> <span class="n">Represents</span> <span class="n">the</span> <span class="o">*</span><span class="n">assumed</span> <span class="n">true</span><span class="o">*</span> <span class="n">configuration</span> <span class="n">of</span> <span class="n">the</span> <span class="n">telescope</span><span class="p">,</span> <span class="n">including</span> <span class="n">a</span> <span class="n">calibration</span> <span class="n">modification</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">distorted</span> <span class="n">ARF</span><span class="p">)</span><span class="o">.</span>
<span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">the</span> <span class="n">synthetic</span><span class="p">,</span> <span class="n">simulated</span> <span class="n">data</span><span class="p">,</span> <span class="n">which</span> <span class="n">reflects</span> <span class="n">the</span> <span class="s2">&quot;ground truth&quot;</span> <span class="n">we</span> <span class="n">are</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">recover</span><span class="o">.</span>
<span class="o">-</span> <span class="n">In</span> <span class="n">practice</span><span class="p">,</span> <span class="n">this</span> <span class="n">produces</span> <span class="n">synthetic</span> <span class="n">spectra</span> <span class="n">using</span> <span class="n">the</span> <span class="n">modified</span> <span class="n">calibration</span><span class="p">,</span> <span class="n">which</span> <span class="n">mimics</span> <span class="n">real</span><span class="o">-</span><span class="n">world</span> <span class="n">observations</span> <span class="n">where</span> <span class="n">the</span> <span class="n">instrument</span> <span class="n">contains</span> <span class="n">unknown</span> <span class="n">biases</span><span class="o">.</span>

<span class="o">**</span><span class="n">Unmodified</span> <span class="n">Configuration</span><span class="o">**</span>

<span class="o">-</span> <span class="n">Represents</span> <span class="n">the</span> <span class="o">*</span><span class="n">assumed</span> <span class="n">incorrect</span><span class="o">*</span> <span class="n">configuration</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">use</span> <span class="n">by</span> <span class="n">the</span> <span class="n">telescope</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">pre</span><span class="o">-</span><span class="n">launch</span> <span class="n">calibration</span> <span class="n">files</span> <span class="ow">or</span> <span class="n">outdated</span> <span class="n">response</span> <span class="n">matrices</span><span class="p">)</span><span class="o">.</span>
<span class="o">-</span> <span class="n">This</span> <span class="n">configuration</span> <span class="ow">is</span> <span class="n">applied</span> <span class="n">during</span> <span class="n">the</span> <span class="n">fitting</span> <span class="n">stage</span><span class="p">,</span> <span class="n">where</span> <span class="n">the</span> <span class="n">synthetic</span> <span class="n">data</span> <span class="p">(</span><span class="n">generated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">modified</span><span class="p">,</span> <span class="n">biased</span> <span class="n">configuration</span><span class="p">)</span> <span class="ow">is</span> <span class="n">analyzed</span> <span class="k">as</span> <span class="k">if</span> <span class="n">the</span> <span class="n">calibration</span> <span class="n">were</span> <span class="n">correct</span><span class="o">.</span>
<span class="o">-</span> <span class="n">The</span> <span class="n">discrepancy</span> <span class="n">between</span> <span class="n">the</span> <span class="n">fitted</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">recovered</span> <span class="n">temperature</span><span class="p">)</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">known</span> <span class="n">simulation</span> <span class="nb">input</span> <span class="n">reflects</span> <span class="n">the</span> <span class="n">calibration</span><span class="o">-</span><span class="n">induced</span> <span class="n">bias</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p><strong>Model Definitions</strong></p>
<p>The second area for customization is the <strong>astrophysical model</strong>, which defines the physical source being simulated and fit.
These models are constructed using XSPEC and typically include components such as thermal plasma models, absorption models, or more complex source descriptions.</p>
<p>The user defines two key methods for model construction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_model_unmodified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_model_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Both methods build and return an XSPEC model instance configured for the specified temperature <code class="docutils literal notranslate"><span class="pre">T</span></code> and parameter grid point <code class="docutils literal notranslate"><span class="pre">**parameters</span></code>.</p>
<p><strong>Modified Model</strong></p>
<ul class="simple">
<li><p>Represents the <em>physical truth</em> model used in the simulation, incorporating the effects of calibration distortions via the modified configuration.</p></li>
<li><p>This model is used alongside the modified configuration to generate the synthetic spectrum with XSPEC’s <code class="docutils literal notranslate"><span class="pre">fakeit</span></code>.</p></li>
<li><p>For example, the modified model might use a distorted ARF or updated effective area curve, reflecting the true instrument state.</p></li>
</ul>
<p><strong>Unmodified Model</strong></p>
<ul class="simple">
<li><p>Represents the model used during spectral fitting under the assumption that the calibration is correct (i.e., using the unmodified configuration).</p></li>
<li><p>Fitting the synthetic data with this model reveals how calibration errors propagate into parameter estimation biases (e.g., incorrect temperature recovery).</p></li>
</ul>
<p>In many cases, the astrophysical model structure is identical between the modified and unmodified cases—only the calibration files differ. However, advanced workflows can modify the source model itself if desired.</p>
</li>
<li><p><strong>Fitting Procedures</strong></p>
<p>The final component under user control is the <strong>fitting logic</strong>, where the synthetic spectra are analyzed to extract physical parameters.</p>
<p>The user provides two methods responsible for performing XSPEC fits and extracting results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fit_unmodified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fit_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Both methods:</p>
<ul class="simple">
<li><p>Receive a configuration dictionary specifying response files, ARFs, exposure, etc.</p></li>
<li><p>Fit the corresponding spectrum loaded into XSPEC.</p></li>
<li><p>Return relevant fit statistics, typically including:</p>
<ul>
<li><p>The best-fit temperature</p></li>
<li><p>Fit quality metrics (e.g., C-statistic, goodness-of-fit)</p></li>
<li><p>Any additional diagnostics relevant to the modification being tested</p></li>
</ul>
</li>
</ul>
<p><strong>Standard Return Convention</strong></p>
<p>While users can modify outputs as needed, the typical return structure is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">best_fit_temperature</span><span class="p">,</span> <span class="n">stat_value</span><span class="p">,</span> <span class="n">additional_metric</span><span class="p">)</span>
</pre></div>
</div>
<p>These results are stored in the HDF5 library file for downstream use.</p>
</li>
</ol>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../overview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">XCalForge | System Overview</p>
      </div>
    </a>
    <a class="right-next"
       href="../../auto_examples/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">XCalForge Example Gallery</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#library-structure">Library Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simulation-process">The Simulation Process</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-simulation-pipelines">Building Simulation Pipelines</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/reference/library/overview.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Eliza Diggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>